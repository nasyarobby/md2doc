
<html>
<head>
<style>
.heading1 {
    font-size: 32pt;
    color: #004080;
}

.heading2 {
    font-size: 24pt;
    color: #004080;
}
</style>
</head>
<body>
<h1 class="heading1">Dokumen Petunjuk Penggunaan Skema Otorisasi DJPOnline menggunakan Oauth2</h1>
<p>Versi 1.0
Tanggal 06 Juni 2021</p>
<p>Direktorat Jenderal Pajak
Kementerian Keuangan Republik Indonesia</p>
<h2 class="heading2">Singkatan dan Istilah</h2>
<h2 class="heading2">Ringkasan Dokumen</h2>
<p>Dokumen ini memuat panduan bagi pengembang baik di dalam DJP maupun di luar DJP dalam mengembangkan sistem yang akan memanfaatkan sistem otorisasi DJPOnline berbasis Oauth 2.0. Skema Jenis authorization grant yang tersedia adalah Authorization Code sesuai dengan IETF RFC 6749.</p>
<h2 class="heading2">Latar Belakang</h2>
<p>Hingga saat ini banyak aplikasi, baik yang dikembangkan oleh DJP maupun oleh pihak di luar DJP, yang memerlukan akses ke data wajib pajak agar dapat berfungsi. Aliran data ini berasal dari DJP selaku pengelola data tersebut ke sistem dimana aplikasi berjalan.</p>
<p>Idealnya, akses data diberikan oleh Wajib Pajak selaku pemilik data, kepada aplikasi yang memerlukan data tersebut. DJP selaku pengelola data, menyediakan data kepada sistem yang telah memiliki izin akses yang diberikan oleh wajib pajak. Skema ini dapat diimplementasikan dengan menggunakan kerangka kerja otorisasi Oauth 2.0. sebagaimana dituangkan pada IETF RFC 6749 (https://datatracker.ietf.org/doc/html/rfc6749).</p>
<p>Untuk mencapai kondisi ideal tersebut, DJP berinisiatif memberikan sistem otorisasi dengan tujuan m</p>
<h2 class="heading2">Ruang Lingkup Dokumen</h2>
<p>Dokumen ini mencakup hal-hal sebagai berikut:</p>
<ol>
<li>informasi pendaftaran aplikasi;</li>
<li>Skema otorisasi Oauth 2.0; dan</li>
<li>Pertimbangan sisi keamanan.</li>
</ol>
<h2 class="heading2">Pendaftaran Aplikasi</h2>
<p>Aplikasi yang didaftarkan harus bersifat <code>confidential</code> , yaitu aplikasi harus dapat mengamankan informasi kredensial (seperti client id dan client secret) sebagaimana dijelaskan pada RFC 6749 Section 2.1 Client Types. Aplikasi yang bersifat <code>public</code> tidak dapat didaftarkan pada sistem Oauth 2.0 DJP.</p>
<h3>Data Client yang diperlukan</h3>
<h2 class="heading2">Spesifikasi API</h2>
<h3>Authorization Request</h3>
<p>Aplikasi membuat request URI dengan spesifikasi di bawah paragraf ini, dengan menggunakan format <code>application/x-www-form-urlencoded</code>.</p>
<pre><code class="language-YAML">paths:
  /oauth2/authorize:
    get:
	  parameters:
		- name: response_type
		  in: query
		  required: true
		  schema:
			type: string
			enum:
			  - code
			  
		- name: client_id
		  in: query
		  required: true
		  schema:
			type: string
			
		- name: redirect_uri
		  in: query
		  required: true
		  schema:
			type: string
		  example: 'http://azvalidation.test/app/'
		  
	responses:
	  '203':
	     description: OK
	  '400':
	     description: Bad request
	  '401':
	     description: Client not found
</code></pre>
<p>Contoh</p>
<pre><code class="language-bash">curl -X 'GET'   'https://server-auth:port/oauth2/authorize?response_type=code&amp;client_id=9fdb8c80-c24f-4f4b-9c3f-4808d88858e7&amp;redirect_uri=http%3A%2F%2Fazvalidation.test%2Fapp%2F'   -H 'accept: */*'
</code></pre>
<p>Sebagai informasi tambahan, sistem Oauth DJP Online tidak mendukung parametere <code>scope</code> dan <code>state</code>. Scope akan diberikan sesuai data yang ada pada sistem DJP sehingga client tidak perlu mencantumkan parameter tersebut.</p>
<p>Response HTTP status code 302 akan diberikan jika data aplikasi lengkap dan valid dan user-agent akan diredirect ke halaman DJP Online dimana wajib pajak dapat login menggunakan akun DJP Online apabila wajib pajak belum terautentikasi pada sistem DJP. Sistem kemudian akan menampilkan informasi aplikasi, jenis data yang akan diakses, serta permintaan otorisasi. Setelah permintaan otorisasi dijawab (baik disetujui maupun ditolak), sistem akan redirect user-agent ke alamat redirection URI sesuai redirect_url yang diberikan sebelumnya.</p>
<p>Jika terdapat kesalahan, sistem akan memberikan response berupa teks dengan kode status HTTP dan isi penjelasan penyebab kesalahan.</p>
<ul>
<li>invalid response type.
<code>response_type</code> tidak diset ke  <code>authorization_code</code>.</li>
<li>Client ID is not set.
<code>client_id</code> tidak diset.</li>
<li>Redirect URI is not set.
<code>redirect_uri</code> tidak diset.</li>
<li>Client not found.
Data client tidak ditemukan pada sistem DJP.</li>
<li>Client data does not contain any eligible scopes.
Data client tidak memuat scopes apapun. Jika hal ini terjadi, silakan konfirmasi kembali ke pihak DJP.</li>
<li>Invalid client data.
<code>redirect_uri</code> tidak sesuai dengan data yang ada pada sistem DJP.</li>
</ul>
<h3>Authorization Response</h3>
<p>Dalam hal wajib pajak memberikan akses, sistem Oauth DJPOnline akan menerbitkan authorization code kepada client dengan menambahkan query <code>code</code> pada redirect_url.</p>
<pre><code class="language-HTTP">HTTP/1.1 302 Found
Location: https://client.example.com/cb?code=SplxlOBeZQQYbYS6WxSbIA
</code></pre>
<p>Sebagai informasi tambahan, query <code>state</code> tidak didukung oleh sistem Oauth DJP.</p>
<h3>Error Response</h3>
<p>Dalam hal wajib pajak tidak menyetujui permintaan akses, Sistem Oauth DJPOnline akan memberikan info tersebut dengan menambahkan query <code>error</code>.</p>
<pre><code class="language-HTTP">HTTP/1.1 302 Found
Location: https://client.example.com/cb?error=access_denied
</code></pre>
<p>Sebagai informasi tambahan, query <code>state</code> tidak didukung oleh sistem Oauth DJP.</p>
<h3>Access Token Request</h3>
<p>Client kemudian dapat mengirimkan permintaan access token sesuai spesifikasi di bawah. Spesifikasi ini sesuai dengan RFC 6749 Section 4.1.3 Access Token Request.</p>
<pre><code class="language-YAML">paths:
  /token:
    post:
      security:
        - clientBasicAuth: []
      requestBody:
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                grant_type:
                  type: string
                  enum:
                    - 'authorization_code'
					
                client_id:
                  type: string
                  example: '9fdb8c80-c24f-4f4b-9c3f-4808d88858e7'
				  
                redirect_uri:
                  type: string
                  example: 'http://azvalidation.test/app/'
				  
                code:
                  type: string
securitySchemes:
  clientBasicAuth:
    type: http
    scheme: basic
</code></pre>
<p>Contoh</p>
<pre><code class="language-bash">curl -X 'POST'   'https://server-auth:port/oauth2/token'   -H 'accept: application/json'   -H 'Authorization: Basic OWZkYjhjODAtYzI0Zi00ZjRiLTljM2YtNDgwOGQ4ODg1OGU3OnMzY3IzdA=='   -H 'Content-Type: application/x-www-form-urlencoded'   -d 'grant_type=authorization_code&amp;client_id=9fdb8c80-c24f-4f4b-9c3f-4808d88858e7&amp;redirect_uri=http%3A%2F%2Fazvalidation.test%2Fapp%2F&amp;code=SplxlOBeZQQYbYS6WxSbIA'
</code></pre>
<h3>Access Token Response</h3>
<p>Jika tidak terdapat kesalahan, server akan merespon dengan kode status HTTP 200 dengan format JSON sebagain berikut:</p>
<pre><code class="language-JSON">{
  &quot;access_token&quot;: &quot;token yang digunakan untuk mengakses data&quot;,
  &quot;token_type&quot;: &quot;jenis token. jwt.&quot;,
  &quot;expires_in&quot;: &quot;jangka waktu token sebelum kadaluarsa dalam detik&quot;
}
</code></pre>
<p>Contoh</p>
<pre><code class="language-HTTP"> HTTP/1.1 200 OK
 Content-Type: application/json;charset=UTF-8
 Cache-Control: no-store
 Pragma: no-cache

 {
   &quot;access_token&quot;:&quot;2YotnFZFEjr1zCsicMWpAA&quot;,
   &quot;token_type&quot;:&quot;jwt&quot;,
   &quot;expires_in&quot;:3600,
 }
</code></pre>
<h3>Error Response</h3>
<p>Dalam hal terjadi kesalahan, server akan merespon dengan kode status HTTP 400 (Bad Request) dengan parameter <code>error</code> pada entity-body dalam format application/json.</p>
<ul>
<li>invalid_request
terdapat parameter yang tidak valid.</li>
<li>invalid_client
client tidak dapat ditemukan atau tidak dapat diautentikasi.</li>
<li>invalid_grant
parameter <code>grant_type</code> tidak sesuai (tidak diset ke <code>'authorization_code'</code>)</li>
</ul>
<p>Contoh</p>
<pre><code class="language-HTTP">HTTP/1.1 400 Bad Request
Content-Type: application/json;charset=UTF-8
Cache-Control: no-store
Pragma: no-cache

{
&quot;error&quot;:&quot;invalid_request&quot;
}
</code></pre>
<h2 class="heading2">Arsitektur Aplikasi dan Jaringan</h2>
<h2 class="heading2">Pertimbangan Sisi Keamanan</h2>
<p>Bagian ini mendefinisikan hal-hal yang harus diimplementasikan dan dipertimbangkan pada sistem yang akan menggunakan sistem Oauth DJP Online.</p>
<ol>
<li>Kredensial klien HARUS diamankan.
Informasi mengenai klien terutama client password harus disimpan dengan aman. Informasi tersebut sebaiknya disimpan pada sisi server, dan TIDAK BOLEH disimpan pada user-agent pengguna aplikasi, misalnya pada local storage browser, cookies, atau lokasi penyimpanan yang dapat diakses dengan mudah oleh pihak lain selain pihak yang mengelola klien.</li>
<li>Access token HARUS diamankan.
Sama halnya dengan kredensial klien, access token yang diterima oleh klien HARUS disimpan pada lokasi yang aman dan TIDAK BOLEH disimpan pada lokasi yang dapat diakses oleh pihak lain selain pihak yang mengelola klien.</li>
</ol>
</body></html>